version: "3.9"

networks:
  wx_o365_net:
    name: wx_o365_net
    
volumes:  
  dynamodb-o365:
    driver: local

services: 
  webex_compliance_o365:
    build:
      context: .
      dockerfile: Dockerfile
    # command: dotenv -f .env_docker run python wxt_compliance_o365.py -vv -c
    command: python wxt_compliance_o365.py -vv -c
    container_name: webex-compliance-o365
    depends_on:
      - dynamodb
    ports:
      - "5050:5050"
    environment:
      PYTHONUNBUFFERED: 'true'
      # TESTVAR: "from_compose"
      #
      # available environment variables in the image (see what TESTVAR does)
      # uncomment and set to your values:
      #
      # WEBEX_INTEGRATION_ID = "your_webex_integration_id"
      # WEBEX_INTEGRATION_CLIENT_SECRET = "your_webex_integration_client_secret"
      # REDIRECT_URI = "your_webex_redirect_uri" # default: "http://localhost:5050/manager"
      # BOT_ACCESS_TOKEN = "your_bot_access_token"
      # O365_TENANT_ID = "your_o365_tenant_id"
      # O365_CLIENT_ID = "your_o365_client_id"
      # O365_OBJECT_ID = "your_o365_object_id"
      # O365_CLIENT_SECRET = "your_o365_client_secret"
    restart: always
    networks:
      - wx_o365_net
    image: jardamartan/webex_compliance_o365

  dynamodb_o365:
    build:
      context: .
      dockerfile: Dockerfile-dynamo
    image: dynamo-o365
    container_name: dynamodb-o365
    command: -jar DynamoDBLocal.jar -sharedDb -dbPath /home/dynamodblocal/data
    restart: always
    volumes:
      - dynamodb-o365:/home/dynamodblocal/data
    networks:
      - wx_o365_net
