version: "2"

networks:
  wx_o365_net:
    # name: wx_o365_net
    
volumes:  
  dynamodb-o365:
    driver: local
  config:

services: 
  webex_compliance_o365:
    build:
      context: .
      dockerfile: Dockerfile
    # command: dotenv -f .env_docker run python wxt_compliance_o365.py -vv -c
    command: python wxt_compliance_o365.py -vv -fnc #-fnmwc
    container_name: webex-compliance-o365
    depends_on:
      - dynamodb_o365
    ports:
      - "5052:5050"
    environment:
      PYTHONUNBUFFERED: 'true'
      # TESTVAR: "from_compose"
      #
      # available environment variables in the image (see what TESTVAR does)
      # uncomment and set to your values:
      #
      WEBEX_INTEGRATION_ID: "Y2lzY29zcGFyazovL3VzL0FQUExJQ0FUSU9OL0M5MWU5MDUxNmRlNzBhOGZiOWQ2OWVkOTk0MmRhM2NlMDE2MjdjMTY4ODI3YmYzZGExOGFkYzVkZTE2ZWY1MTI0"
      WEBEX_INTEGRATION_CLIENT_ID: "C91e90516de70a8fb9d69ed9942da3ce01627c168827bf3da18adc5de16ef5124"
      WEBEX_INTEGRATION_CLIENT_SECRET: "36c18bcdc42d48b87b4e978b09fa6c0304cb956a85a8c223a8eae530d947ee81"

      WEBEX_TEAMS_ACCESS_TOKEN: "dummy"

      BOT_ACCESS_TOKEN: "ZTU2YmQ5ZjgtMWVkNi00NjBjLTlmZmQtNWY4Y2VjOTllOTQwZmI2NDgyYTctNDY3_PF84_1eb65fdf-9643-417f-9974-ad72cae0e10f"
      BOT_ID: "Y2lzY29zcGFyazovL3VzL1BFT1BMRS8wOGZkZmVmZS1hNTc2LTQ2NWMtYmNjNC1iYjU4M2YxYzlmYjA"

      REDIRECT_URI: "http://localhost:5052/manager"

      DYNAMODB_ENDPOINT_URL: "http://dynamodb-o365:8000"
      DYNAMODB_TABLE_NAME: "o365_bot_test"
      AWS_DEFAULT_REGION: "us-east-1"
      AWS_ACCESS_KEY_ID: "dummy"
      AWS_SECRET_ACCESS_KEY: "dummy"

      O365_CLIENT_ID: "b5a19883-ba92-4ae6-beb5-9f252f432e31"
      O365_TENANT_ID: "28203df6-837c-48b7-8e08-70965c189f00"
      O365_OBJECT_ID: "c05164cb-7e2e-4598-9e47-360cedf427cb"
      O365_CLIENT_SECRET: "yoQo4V.o_r4S2uqZdS4djz2jr7ZZ-o3A-7"
      
      URL_ONEDRIVE_LINK: "https://help.webex.com/cs-cz/n4ve41eb/Webex-Link-a-Microsoft-OneDrive-or-SharePoint-Online-Folder-to-a-Space"
      URL_IDM: "https://help.webex.com/cs-cz/n4ve41eb/Webex-Link-a-Microsoft-OneDrive-or-SharePoint-Online-Folder-to-a-Space"
      
      # WEBEX_INTEGRATION_ID: "your_webex_integration_id"
      # WEBEX_INTEGRATION_CLIENT_SECRET: "your_webex_integration_client_secret"
      # REDIRECT_URI: "your_webex_redirect_uri" # default: "http://localhost:5050/manager"
      # BOT_ACCESS_TOKEN: "your_bot_access_token"
      # O365_TENANT_ID: "your_o365_tenant_id"
      # O365_CLIENT_ID: "your_o365_client_id"
      # O365_OBJECT_ID: "your_o365_object_id"
      # O365_CLIENT_SECRET: "your_o365_client_secret"
      # DYNAMODB_ENDPOINT_URL: "http://dynamodb-o365:8000"
      # DYNAMODB_TABLE_NAME: "o365_bot_test"
      # AWS_DEFAULT_REGION: "us-east-1"
      # AWS_ACCESS_KEY_ID: "dummy"
      # AWS_SECRET_ACCESS_KEY: "dummy"
      # WEBEX_TEAMS_ACCESS_TOKEN: "dummy"
    restart: always
    networks:
      - wx_o365_net
    volumes:
      - ./config/config.json:/config/config.json
    image: jardamartan/webex_compliance_o365

  dynamodb_o365:
    build:
      context: .
      dockerfile: Dockerfile-dynamo
    image: dynamo-o365
    container_name: dynamodb-o365
    command: -jar DynamoDBLocal.jar -sharedDb -dbPath /home/dynamodblocal/data
    restart: always
    volumes:
      - dynamodb-o365:/home/dynamodblocal/data
    networks:
      - wx_o365_net
